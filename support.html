<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&family=Courgette&display=swap" rel="stylesheet">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ripple AI Assistant</title>
<link rel="stylesheet" href="main.css">
<link rel="stylesheet" href="support.css">
</head>
<body style="width:100%; overflow-x: hidden;">
  <div id="header-placeholder"></div>


<div class="title">Ripple AI Assistant</div>
<div class="subtitle">Ask me anything about opportunities, events, or our mission</div>

<div class="chat-box">
    <div class="message" id="initialGreeting">Hello, I'm here to answer any questions and help you learn about Ripple. How may assist you?</div>
</div>

<div class="input-area">
    <input type="text" placeholder="Type your message here..." />
    <div class="send-btn db">âž¤</div>
</div>

<footer class="footer" style="margin-top: 221px; width: 100%">
  <div id="footer-placeholder"></div>
</footer>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyBguT9BsQHwsAwAd3mbEmj3S5E7GtR_IBU",
    authDomain: "webmaster-v4-0.firebaseapp.com",
    projectId: "webmaster-v4-0",
    storageBucket: "webmaster-v4-0.firebasestorage.app",
    messagingSenderId: "413556961992",
    appId: "1:413556961992:web:899600895ecb68eb9debfd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Chatbot functionality
const sendBtn = document.querySelector('.send-btn');
const input = document.querySelector('.input-area input');
const chatBox = document.querySelector('.chat-box');
const API_KEY = 'F6hJTUzhRv4lx5XAYCV3g4z5bXpXTwsT';

const WEBSITE_CONTEXT = `You are the Ripple AI Assistant for the Ripple Community website. Here's information about the website to help you answer user questions:

ABOUT RIPPLE:
- Ripple connects community members with meaningful opportunities to create positive change
- Mission: Creating ripples of change across our community, one small action at a time
- We believe small actions create ripples of impact across neighborhoods
- Focus areas: mental health, volunteering, environmental protection, and community events

RESOURCES PAGE:
The Resources section provides community health resources and events, including:
- Mindfulness Meditation Guide (Mental Health)
- Understanding Anxiety (Mental Health)
- Healthy Eating Tips (Nutrition)
- Exercise Routines for Beginners (Physical Health)
- Local Wellness Workshops (Wellness)
- Support Group Directory (Support Groups)

COMMUNITY GROUPS:
- Environmental Action Group (238 members) - Focus on sustainability
- Mental Health Support Circle (602 members) - Safe space for mental health discussions
- Volunteer Network (842 members) - Local volunteer opportunities
- Community Event Hub (312 members) - Local gatherings and events
- Donation Drive Coordinators (215 members) - Help organize donation campaigns

NAVIGATION:
Website pages: Home, Resources, Communities, Support, Calendar

When answering questions, be helpful, friendly, and refer users to relevant pages or resources on the website when appropriate.`;

async function sendMessage() {
  const userMessage = input.value.trim();
  if (!userMessage) return;

  sendBtn.disabled = true;
  sendBtn.style.opacity = '0.5';

  const userMessageDiv = document.createElement('div');
  userMessageDiv.className = 'message user-message';
  userMessageDiv.textContent = userMessage;
  chatBox.appendChild(userMessageDiv);
  input.value = '';

  try {
    const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + API_KEY
      },
      body: JSON.stringify({
        model: 'mistral-small-latest',
        messages: [
          {
            role: 'system',
            content: WEBSITE_CONTEXT
          },
          {
            role: 'user',
            content: userMessage
          }
        ]
      })
    });

    let botResponse = 'Sorry, I could not process your request.';
    
    if (response.ok) {
      const data = await response.json();
      if (data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content) {
        botResponse = data.choices[0].message.content;
      }
    } else {
      botResponse = 'Error: ' + response.status + ' ' + response.statusText;
    }

    const botMessageContainer = document.createElement('div');
    botMessageContainer.className = 'bot-message-container';
    
    const botMessageDiv = document.createElement('div');
    botMessageDiv.className = 'message';
    botMessageDiv.style.whiteSpace = 'pre-wrap';
    botMessageDiv.textContent = botResponse;
    
    const reactionsDiv = document.createElement('div');
    reactionsDiv.className = 'message-reactions';
    
    const thumbsUpBtn = document.createElement('button');
    thumbsUpBtn.className = 'reaction-btn thumbs-up';
    thumbsUpBtn.textContent = 'ðŸ‘';
    thumbsUpBtn.addEventListener('click', function() {
      thumbsUpBtn.classList.add('active');
      thumbsDownBtn.classList.remove('active');
    });
    
    const thumbsDownBtn = document.createElement('button');
    thumbsDownBtn.className = 'reaction-btn thumbs-down';
    thumbsDownBtn.textContent = 'ðŸ‘Ž';
    thumbsDownBtn.addEventListener('click', function() {
      thumbsDownBtn.classList.add('active');
      thumbsUpBtn.classList.remove('active');
    });
    
    reactionsDiv.appendChild(thumbsUpBtn);
    reactionsDiv.appendChild(thumbsDownBtn);
    
    botMessageContainer.appendChild(botMessageDiv);
    botMessageContainer.appendChild(reactionsDiv);
    chatBox.appendChild(botMessageContainer);
    chatBox.scrollTop = chatBox.scrollHeight;
  } catch (error) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'message';
    errorDiv.textContent = 'Error: ' + error.message;
    chatBox.appendChild(errorDiv);
  } finally {
    sendBtn.disabled = false;
    sendBtn.style.opacity = '1';
  }
}

sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    sendMessage();
  }
});

// Auth state
onAuthStateChanged(auth, (user) => {
  const avatar = document.querySelector('.avatar');
  const navRight = document.querySelector('.nav-right');
  
  if (user) {
    const initial = (user.email || '').charAt(0).toUpperCase();
    if (avatar) {
      if (user.photoURL) {
        avatar.style.backgroundImage = `url('${user.photoURL}')`;
        avatar.style.backgroundSize = 'cover';
        avatar.style.backgroundPosition = 'center';
        avatar.textContent = '';
      } else {
        avatar.style.backgroundImage = '';
        avatar.textContent = initial;
      }
      avatar.style.cursor = 'pointer';
      avatar.onclick = () => window.location.href = 'account.html';
    }
    

  } else {
    if (avatar) {
      avatar.textContent = '';
    }
    const signOutBtn = document.querySelector('.sign-out-btn');
    if (signOutBtn) {
      signOutBtn.remove();
    }
    if (navRight && !document.querySelector('.sign-in-btn')) {
      const signInBtn = document.createElement('button');
      signInBtn.textContent = 'Sign In';
      signInBtn.className = 'sign-in-btn';
      signInBtn.style.padding = '8px 16px';
      signInBtn.style.background = 'linear-gradient(to bottom, #4c7dff, #2e63e5)';
      signInBtn.style.color = 'white';
      signInBtn.style.border = 'none';
      signInBtn.style.borderRadius = '999px';
      signInBtn.style.cursor = 'pointer';
      signInBtn.style.fontSize = '14px';
      signInBtn.style.fontWeight = '600';
      signInBtn.style.boxShadow = '0 4px 12px rgba(76, 125, 255, 0.25)';
      signInBtn.style.transition = 'transform 0.1s ease, box-shadow 0.1s ease';
      signInBtn.onclick = () => window.location.href = 'login.html';
      signInBtn.onmouseover = () => {
        signInBtn.style.transform = 'translateY(-1px)';
        signInBtn.style.boxShadow = '0 6px 16px rgba(76, 125, 255, 0.35)';
      };
      signInBtn.onmouseout = () => {
        signInBtn.style.transform = 'translateY(0)';
        signInBtn.style.boxShadow = '0 4px 12px rgba(76, 125, 255, 0.25)';
      };
      navRight.appendChild(signInBtn);
    }
  }
});
</script>

<script>
// Non-module script for hamburger menu (can't access module variables)
document.addEventListener('DOMContentLoaded', function() {
  const hamburger = document.querySelector('.hamburger');
  const navLinks = document.querySelector('.nav-links');

  if (hamburger && navLinks) {
    hamburger.addEventListener('click', function() {
      navLinks.classList.toggle('open');
    });

    document.addEventListener('click', function(event) {
      if (!hamburger.contains(event.target) && !navLinks.contains(event.target)) {
        navLinks.classList.remove('open');
      }
    });

    const navLinkElements = document.querySelectorAll('.nav-link');
    navLinkElements.forEach(link => {
      link.addEventListener('click', function() {
        navLinks.classList.remove('open');
      });
    });
  }
});
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const footerPlaceholder = document.getElementById('footer-placeholder');
    if (footerPlaceholder) {
      fetch('footer.html')
        .then(response => response.text())
        .then(html => {
          footerPlaceholder.innerHTML = html;
        })
        .catch(error => {
          console.error('Error loading footer:', error);
        });
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const headerPlaceholder = document.getElementById('header-placeholder');
    if (!headerPlaceholder) return;

    fetch('header.html')
      .then(response => response.text())
      .then(html => {
        headerPlaceholder.innerHTML = html;

        // 1) Set active link for this page automatically
        const path = window.location.pathname.split('/').pop(); // gets "main.html"
        const links = headerPlaceholder.querySelectorAll('.nav-link');
        links.forEach(link => {
          const href = link.getAttribute('href');
          if (href === path) {
            link.classList.add('active');
          } else {
            link.classList.remove('active');
          }
        });

        // 2) Wire up hamburger menu
        const hamburger = headerPlaceholder.querySelector('.hamburger');
        const navLinks = headerPlaceholder.querySelector('.nav-links');

        if (hamburger && navLinks) {
          hamburger.addEventListener('click', function (event) {
            event.stopPropagation();
            navLinks.classList.toggle('open');
          });

          document.addEventListener('click', function (event) {
            if (!navLinks.contains(event.target) && !hamburger.contains(event.target)) {
              navLinks.classList.remove('open');
            }
          });

          const navLinkElements = headerPlaceholder.querySelectorAll('.nav-link');
          navLinkElements.forEach(link => {
            link.addEventListener('click', function () {
              navLinks.classList.remove('open');
            });
          });
        }
      })
      .catch(error => {
        console.error('Error loading header:', error);
      });
  });
</script>
<script src="bubble-transition.js"></script>
<script src="bubble-nav.js"></script>
</body>
</html>
